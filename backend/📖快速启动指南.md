# ğŸš€ SkyRiff åç«¯å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸ“‹ ç›®å½•
1. [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
2. [å¿«é€Ÿå¯åŠ¨](#å¿«é€Ÿå¯åŠ¨)
3. [è¯¦ç»†æ­¥éª¤](#è¯¦ç»†æ­¥éª¤)
4. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
5. [æµ‹è¯•æ¥å£](#æµ‹è¯•æ¥å£)

---

## ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶
- âœ… **Python 3.10+** 
  - ä¸‹è½½ï¼šhttps://www.python.org/downloads/
  - å®‰è£…æ—¶å‹¾é€‰ "Add Python to PATH"
  
- âœ… **PostgreSQL 14+**
  - ä¸‹è½½ï¼šhttps://www.postgresql.org/download/windows/
  - æˆ–ä½¿ç”¨ Dockerï¼š`docker run --name postgres -e POSTGRES_PASSWORD=postgres -p 5432:5432 -d postgres`

### å¯é€‰è½¯ä»¶
- Redisï¼ˆç”¨äºç¼“å­˜ï¼Œå¯é€‰ï¼‰
- Gitï¼ˆç”¨äºä»£ç ç®¡ç†ï¼‰

---

## å¿«é€Ÿå¯åŠ¨

### æ–¹æ³•1ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰â­

```bash
# 1. è¿›å…¥åç«¯ç›®å½•
cd D:\Figma_skyriff\backend

# 2. å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
ğŸš€ä¸€é”®å®‰è£…ä¾èµ–-å›½å†…åŠ é€Ÿ.bat

# 3. å¯åŠ¨æœåŠ¡å™¨
å¯åŠ¨åç«¯.bat
```

### æ–¹æ³•2ï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
# 1. å®‰è£…ä¾èµ–
python -m pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 2. å¯åŠ¨æœåŠ¡å™¨
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

---

## è¯¦ç»†æ­¥éª¤

### æ­¥éª¤1ï¸âƒ£ï¼šæ£€æŸ¥ç¯å¢ƒ

è¿è¡Œç¯å¢ƒæ£€æŸ¥è„šæœ¬ï¼š
```bash
ğŸ”æ£€æŸ¥ç¯å¢ƒ.bat
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
âœ… Python 3.10.0
âœ… pip 23.0.1
âœ… FastAPI: 0.109.0
âœ… Uvicorn: 0.27.0
âœ… SQLAlchemy: 2.0.25
âœ… Pydantic Settings: å·²å®‰è£…
âœ… PostgreSQL è¿æ¥æˆåŠŸ
```

å¦‚æœæœ‰ âŒï¼Œæ ¹æ®æç¤ºä¿®å¤ã€‚

---

### æ­¥éª¤2ï¸âƒ£ï¼šå®‰è£…ä¾èµ–

#### é€‰é¡¹Aï¼šå›½å†…ç”¨æˆ·ï¼ˆæ¨èï¼‰ğŸ‡¨ğŸ‡³
```bash
ğŸš€ä¸€é”®å®‰è£…ä¾èµ–-å›½å†…åŠ é€Ÿ.bat
```

#### é€‰é¡¹Bï¼šå›½é™…ç”¨æˆ·
```bash
ğŸš€ä¸€é”®å®‰è£…ä¾èµ–.bat
```

#### é€‰é¡¹Cï¼šæœ€å°ä¾èµ–ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰
```bash
python -m pip install -r requirements-minimal.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

**å®‰è£…æ—¶é—´ï¼š** çº¦ 2-5 åˆ†é’Ÿ

---

### æ­¥éª¤3ï¸âƒ£ï¼šé…ç½®æ•°æ®åº“

#### A. ä½¿ç”¨ PostgreSQL

1. **ç¡®ä¿ PostgreSQL å·²å¯åŠ¨**
   ```bash
   # æ£€æŸ¥æœåŠ¡çŠ¶æ€
   sc query postgresql-x64-14
   ```

2. **åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·**
   ```sql
   -- æ‰“å¼€ pgAdmin æˆ– psql
   CREATE USER skyriff WITH PASSWORD 'skyriff123';
   CREATE DATABASE skyriff_db OWNER skyriff;
   GRANT ALL PRIVILEGES ON DATABASE skyriff_db TO skyriff;
   ```

3. **æ£€æŸ¥ .env é…ç½®**
   ```env
   DATABASE_URL=postgresql://skyriff:skyriff123@localhost:5432/skyriff_db
   ```

#### B. æˆ–ä½¿ç”¨ SQLiteï¼ˆç®€å•æ¨¡å¼ï¼‰

ä¿®æ”¹ `/backend/.env`ï¼š
```env
DATABASE_URL=sqlite:///./skyriff.db
```

---

### æ­¥éª¤4ï¸âƒ£ï¼šå¯åŠ¨æœåŠ¡å™¨

```bash
å¯åŠ¨åç«¯.bat
```

**æˆåŠŸè¾“å‡ºï¼š**
```
ğŸš€ SkyRiff starting...
ğŸ“ Environment: development
ğŸ”§ Debug mode: True
ğŸ—„ï¸  Initializing database...
âœ… Database initialized
INFO:     Uvicorn running on http://0.0.0.0:8000
INFO:     Application startup complete.
```

**è®¿é—®ï¼š** http://localhost:8000

---

## å¸¸è§é—®é¢˜

### âŒ é—®é¢˜1ï¼š`ModuleNotFoundError: No module named 'pydantic_settings'`

**åŸå› ï¼š** ä¾èµ–æœªå®‰è£…

**è§£å†³ï¼š**
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨å®‰è£…è„šæœ¬
ğŸš€ä¸€é”®å®‰è£…ä¾èµ–-å›½å†…åŠ é€Ÿ.bat

# æ–¹æ³•2ï¼šæ‰‹åŠ¨å®‰è£…
python -m pip install pydantic-settings -i https://pypi.tuna.tsinghua.edu.cn/simple
```

---

### âŒ é—®é¢˜2ï¼š`curl: (7) Failed to connect to localhost port 8000`

**åŸå› ï¼š** åç«¯æœªå¯åŠ¨

**è§£å†³ï¼š**
```bash
# 1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
netstat -ano | findstr :8000

# 2. å¯åŠ¨åç«¯
å¯åŠ¨åç«¯.bat
```

---

### âŒ é—®é¢˜3ï¼š`ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„è·¯å¾„ (venv\Scripts\activate)`

**åŸå› ï¼š** è™šæ‹Ÿç¯å¢ƒä¸å­˜åœ¨ï¼ˆä¸å½±å“è¿è¡Œï¼‰

**è¯´æ˜ï¼š** æœ¬é¡¹ç›®ç›´æ¥ä½¿ç”¨ç³»ç»Ÿ Pythonï¼Œæ— éœ€è™šæ‹Ÿç¯å¢ƒ

---

### âŒ é—®é¢˜4ï¼šPostgreSQL è¿æ¥å¤±è´¥

**è§£å†³ï¼š**

1. **æ£€æŸ¥ PostgreSQL æ˜¯å¦å¯åŠ¨**
   ```bash
   sc query postgresql-x64-14
   ```

2. **æ£€æŸ¥ç«¯å£å ç”¨**
   ```bash
   netstat -ano | findstr :5432
   ```

3. **ä½¿ç”¨ SQLite æ›¿ä»£**ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
   ä¿®æ”¹ `.env`ï¼š
   ```env
   DATABASE_URL=sqlite:///./skyriff.db
   ```

---

### âŒ é—®é¢˜5ï¼šç«¯å£ 8000 è¢«å ç”¨

**è§£å†³ï¼š**

```bash
# æ–¹æ³•1ï¼šæŸ¥æ‰¾å¹¶ç»“æŸå ç”¨è¿›ç¨‹
netstat -ano | findstr :8000
taskkill /PID <è¿›ç¨‹ID> /F

# æ–¹æ³•2ï¼šä½¿ç”¨å…¶ä»–ç«¯å£
python -m uvicorn app.main:app --port 8001
```

---

## æµ‹è¯•æ¥å£

### 1ï¸âƒ£ å¥åº·æ£€æŸ¥

```bash
curl http://localhost:8000/health
```

**é¢„æœŸå“åº”ï¼š**
```json
{
    "status": "healthy"
}
```

---

### 2ï¸âƒ£ API æ–‡æ¡£

è®¿é—®ï¼šhttp://localhost:8000/docs

**åŠŸèƒ½ï¼š**
- ğŸ“– æŸ¥çœ‹æ‰€æœ‰ API æ¥å£
- ğŸ§ª åœ¨çº¿æµ‹è¯•æ¥å£
- ğŸ“ æŸ¥çœ‹è¯·æ±‚/å“åº”æ ¼å¼

---

### 3ï¸âƒ£ æµ‹è¯•ç™»å½•

```bash
curl -X POST http://localhost:8000/api/v1/auth/login_mock ^
  -H "Content-Type: application/json" ^
  -d "{\"user_id\": 1}"
```

**é¢„æœŸå“åº”ï¼š**
```json
{
    "code": 200,
    "message": "ç™»å½•æˆåŠŸ",
    "data": {
        "access_token": "eyJ...",
        "token_type": "bearer",
        "user_id": 1
    }
}
```

---

### 4ï¸âƒ£ æŸ¥çœ‹é’±åŒ…

```bash
# å…ˆç™»å½•è·å– token
set TOKEN=<ç™»å½•è¿”å›çš„access_token>

curl http://localhost:8000/api/v1/wallets/me ^
  -H "Authorization: Bearer %TOKEN%"
```

---

## ğŸ¯ å¯åŠ¨æµç¨‹æ€»ç»“

```
1. æ£€æŸ¥ç¯å¢ƒ (ğŸ”æ£€æŸ¥ç¯å¢ƒ.bat)
   â†“
2. å®‰è£…ä¾èµ– (ğŸš€ä¸€é”®å®‰è£…ä¾èµ–-å›½å†…åŠ é€Ÿ.bat)
   â†“
3. é…ç½®æ•°æ®åº“ (.env æ–‡ä»¶)
   â†“
4. å¯åŠ¨æœåŠ¡å™¨ (å¯åŠ¨åç«¯.bat)
   â†“
5. æµ‹è¯•æ¥å£ (è®¿é—® /health)
   â†“
6. âœ… æˆåŠŸè¿è¡Œï¼
```

---

## ğŸ“‚ è„šæœ¬è¯´æ˜

| è„šæœ¬ | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| `ğŸ”æ£€æŸ¥ç¯å¢ƒ.bat` | ç¯å¢ƒæ£€æŸ¥ | è¯Šæ–­é—®é¢˜ |
| `ğŸš€ä¸€é”®å®‰è£…ä¾èµ–.bat` | å®‰è£…ä¾èµ–ï¼ˆå›½é™…ï¼‰ | é¦–æ¬¡å®‰è£… |
| `ğŸš€ä¸€é”®å®‰è£…ä¾èµ–-å›½å†…åŠ é€Ÿ.bat` | å®‰è£…ä¾èµ–ï¼ˆå›½å†…é•œåƒï¼‰â­ | æ¨èä½¿ç”¨ |
| `å¯åŠ¨åç«¯.bat` | å¯åŠ¨æœåŠ¡å™¨ | æ—¥å¸¸ä½¿ç”¨ |
| `requirements.txt` | å®Œæ•´ä¾èµ–åˆ—è¡¨ | ç”Ÿäº§ç¯å¢ƒ |
| `requirements-minimal.txt` | æœ€å°ä¾èµ– | å¿«é€Ÿæµ‹è¯• |

---

## ğŸ”§ å¼€å‘æ¨¡å¼

### å¯åŠ¨é€‰é¡¹

```bash
# é»˜è®¤å¯åŠ¨ï¼ˆè‡ªåŠ¨é‡è½½ï¼‰
python -m uvicorn app.main:app --reload

# æŒ‡å®šç«¯å£
python -m uvicorn app.main:app --port 8001

# ç”Ÿäº§æ¨¡å¼ï¼ˆæ— è‡ªåŠ¨é‡è½½ï¼‰
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000

# å¤šè¿›ç¨‹ï¼ˆç”Ÿäº§ï¼‰
uvicorn app.main:app --workers 4
```

---

## ğŸ“Š æœåŠ¡å™¨ä¿¡æ¯

- **åœ°å€ï¼š** http://localhost:8000
- **API æ–‡æ¡£ï¼š** http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥ï¼š** http://localhost:8000/health
- **æ ¹è·¯å¾„ï¼š** http://localhost:8000/

---

## ğŸ‰ æˆåŠŸæ ‡å¿—

å½“çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼Œè¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼š

```
âœ… Database initialized
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

---

## ğŸ’¡ ä¸‹ä¸€æ­¥

1. âœ… åç«¯å¯åŠ¨æˆåŠŸ
2. æ‰“å¼€å‰ç«¯åº”ç”¨
3. ä½¿ç”¨ user_id = 1 ç™»å½•
4. å¼€å§‹ä½“éªŒ SkyRiffï¼

---

**æœ€åæ›´æ–°ï¼š** 2024-12-26  
**ç»´æŠ¤è€…ï¼š** SkyRiff Team  
**é—®é¢˜åé¦ˆï¼š** æŸ¥çœ‹ [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜) æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ