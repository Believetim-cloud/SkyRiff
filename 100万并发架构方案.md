# ğŸš€ SkyRiff è¶…å¤§è§„æ¨¡æ¶æ„æ–¹æ¡ˆ
## 100ä¸‡+ åŒæ—¶åœ¨çº¿ç”¨æˆ·

---

## ğŸ“Š æ€§èƒ½ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|------|--------|
| **åŒæ—¶åœ¨çº¿ç”¨æˆ·** | 1,000,000+ |
| **å³°å€¼QPS** | 500,000-1,000,000 |
| **å¹³å‡å“åº”æ—¶é—´** | < 100ms |
| **P99 å“åº”æ—¶é—´** | < 500ms |
| **å¯ç”¨æ€§** | 99.99% (å¹´æ•…éšœ < 52åˆ†é’Ÿ) |
| **æ•°æ®åº“è¯»å†™** | 100,000+ QPS |
| **è§†é¢‘ç”Ÿæˆå¹¶å‘** | 10,000+ ä»»åŠ¡/å°æ—¶ |

---

## ğŸ—ï¸ å®Œæ•´æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å…¨çƒç”¨æˆ· (1,000,000+)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å…¨çƒ CDN (å¤šèŠ‚ç‚¹åŠ é€Ÿ)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ ç¾å›½è¥¿éƒ¨ â”‚ ç¾å›½ä¸œéƒ¨ â”‚ æ¬§æ´²     â”‚ äºšæ´²     â”‚         â”‚
â”‚  â”‚ èŠ‚ç‚¹     â”‚ èŠ‚ç‚¹     â”‚ èŠ‚ç‚¹     â”‚ èŠ‚ç‚¹     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  - é™æ€èµ„æºç¼“å­˜ (å‰ç«¯ã€å›¾ç‰‡ã€è§†é¢‘)                      â”‚
â”‚  - æ™ºèƒ½è·¯ç”±ï¼Œå°±è¿‘è®¿é—®                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DNS æ™ºèƒ½è§£æ                           â”‚
â”‚  - æ ¹æ®ç”¨æˆ·åœ°ç†ä½ç½®åˆ†é…æœ€è¿‘çš„æœåŠ¡å™¨                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             å…¨å±€è´Ÿè½½å‡è¡¡ (GSLB)                          â”‚
â”‚  - é˜¿é‡Œäº‘ GSLB / AWS Route 53                          â”‚
â”‚  - å¤šåœ°åŸŸæµé‡åˆ†å‘                                       â”‚
â”‚  - æ•…éšœè‡ªåŠ¨åˆ‡æ¢                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åä¸œåŒºåŸŸ     â”‚   â”‚ ååŒ—åŒºåŸŸ     â”‚   â”‚ åå—åŒºåŸŸ     â”‚
â”‚ (ä¸»)         â”‚   â”‚ (å¤‡)         â”‚   â”‚ (å¤‡)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            åŒºåŸŸè´Ÿè½½å‡è¡¡ (SLB/ALB)                        â”‚
â”‚  - Layer 7 è´Ÿè½½å‡è¡¡                                      â”‚
â”‚  - SSL ç»ˆæ­¢                                              â”‚
â”‚  - å¥åº·æ£€æŸ¥                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API ç½‘å…³é›†ç¾¤                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ - é™æµç†”æ–­ (æ¯ç”¨æˆ· 100 req/s)       â”‚               â”‚
â”‚  â”‚ - API é‰´æƒ                          â”‚               â”‚
â”‚  â”‚ - è¯·æ±‚è·¯ç”±                          â”‚               â”‚
â”‚  â”‚ - ç›‘æ§ç»Ÿè®¡                          â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  å®ä¾‹æ•°: 20-50 ä¸ª (8æ ¸16G)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼                 â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æœåŠ¡é›†ç¾¤ â”‚ â”‚ è§†é¢‘æœåŠ¡é›†ç¾¤ â”‚ â”‚ æ”¯ä»˜æœåŠ¡é›†ç¾¤ â”‚ â”‚ ç¤¾äº¤æœåŠ¡é›†ç¾¤ â”‚
â”‚ (50ä¸ªå®ä¾‹)   â”‚ â”‚ (100ä¸ªå®ä¾‹)  â”‚ â”‚ (30ä¸ªå®ä¾‹)   â”‚ â”‚ (50ä¸ªå®ä¾‹)   â”‚
â”‚ 8æ ¸16G       â”‚ â”‚ 8æ ¸16G       â”‚ â”‚ 8æ ¸16G       â”‚ â”‚ 8æ ¸16G       â”‚
â”‚              â”‚ â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ - ç™»å½•æ³¨å†Œ   â”‚ â”‚ - è§†é¢‘ç”Ÿæˆ   â”‚ â”‚ - ç§¯åˆ†å……å€¼   â”‚ â”‚ - ç‚¹èµè¯„è®º   â”‚
â”‚ - ä¸ªäººèµ„æ–™   â”‚ â”‚ - è§†é¢‘åˆ—è¡¨   â”‚ â”‚ - é‡‘å¸æç°   â”‚ â”‚ - å…³æ³¨ç²‰ä¸   â”‚
â”‚ - æƒé™éªŒè¯   â”‚ â”‚ - è§†é¢‘è¯¦æƒ…   â”‚ â”‚ - æœˆå¡è®¢é˜…   â”‚ â”‚ - æ¶ˆæ¯é€šçŸ¥   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åˆ†å¸ƒå¼ç¼“å­˜å±‚ (Redis Cluster)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ä¸»èŠ‚ç‚¹1â”‚ ä¸»èŠ‚ç‚¹2â”‚ ä¸»èŠ‚ç‚¹3â”‚ ä¸»èŠ‚ç‚¹4â”‚ ä¸»èŠ‚ç‚¹5â”‚        â”‚
â”‚  â”‚ +ä»èŠ‚ç‚¹â”‚ +ä»èŠ‚ç‚¹â”‚ +ä»èŠ‚ç‚¹â”‚ +ä»èŠ‚ç‚¹â”‚ +ä»èŠ‚ç‚¹â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€ï¿½ï¿½â”€â”€â”˜        â”‚
â”‚  é…ç½®: æ¯ä¸ªä¸»èŠ‚ç‚¹ 16G å†…å­˜                               â”‚
â”‚  æ•°æ®: çƒ­ç‚¹æ•°æ®ã€ä¼šè¯ã€æ’è¡Œæ¦œ                           â”‚
â”‚  å‘½ä¸­ç‡: > 95%                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            æ•°æ®åº“é›†ç¾¤ (PostgreSQL)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚        ä¸»åº“ (å†™æ“ä½œ)                â”‚                â”‚
â”‚  â”‚        32æ ¸64G + SSD                â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚          â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â–¼                â–¼            â–¼            â–¼          â”‚
â”‚  ä»åº“1 (è¯»)      ä»åº“2 (è¯»)    ä»åº“3 (è¯»)   ä»åº“4 (è¯»)  â”‚
â”‚  32æ ¸64G         32æ ¸64G       32æ ¸64G      32æ ¸64G    â”‚
â”‚                                                          â”‚
â”‚  æ•°æ®åˆ†ç‰‡ç­–ç•¥:                                           â”‚
â”‚  - users è¡¨: æŒ‰ user_id % 10 åˆ†ç‰‡                       â”‚
â”‚  - works è¡¨: æŒ‰ created_at åˆ†è¡¨ (æŒ‰æœˆ)                  â”‚
â”‚  - orders è¡¨: æŒ‰ user_id åˆ†ç‰‡                           â”‚
â”‚  - è¯»å†™åˆ†ç¦»: å†™ä¸»åº“ï¼Œè¯»ä»åº“                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ¶ˆæ¯é˜Ÿåˆ— (Kafka/RabbitMQ)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ è§†é¢‘ç”Ÿæˆé˜Ÿåˆ— (é«˜ä¼˜å…ˆçº§)             â”‚               â”‚
â”‚  â”‚ é€šçŸ¥æ¨é€é˜Ÿåˆ—                         â”‚               â”‚
â”‚  â”‚ æ•°æ®ç»Ÿè®¡é˜Ÿåˆ—                         â”‚               â”‚
â”‚  â”‚ æ—¥å¿—æ”¶é›†é˜Ÿåˆ—                         â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  é›†ç¾¤: 5ä¸ªèŠ‚ç‚¹ï¼Œæ”¯æŒç™¾ä¸‡çº§æ¶ˆæ¯/ç§’                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å¼‚æ­¥ä»»åŠ¡å¤„ç†é›†ç¾¤ (Celery Workers)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Worker â”‚ Worker â”‚ Worker â”‚ Worker â”‚ Worker â”‚        â”‚
â”‚  â”‚  1-50  â”‚ 51-100 â”‚101-150 â”‚151-200 â”‚201-300 â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  æ¯ä¸ª Worker: 4æ ¸8G                                     â”‚
â”‚  ä»»åŠ¡ç±»å‹:                                               â”‚
â”‚  - è°ƒç”¨ Sora API ç”Ÿæˆè§†é¢‘                               â”‚
â”‚  - å‘é€é€šçŸ¥                                              â”‚
â”‚  - æ•°æ®ç»Ÿè®¡                                              â”‚
â”‚  - è§†é¢‘è½¬ç                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å¯¹è±¡å­˜å‚¨ (OSS/S3) + CDN                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡: 500TB                 â”‚               â”‚
â”‚  â”‚ ç”Ÿæˆè§†é¢‘: 2PB                       â”‚               â”‚
â”‚  â”‚ ç”¨æˆ·å¤´åƒ: 50TB                      â”‚               â”‚
â”‚  â”‚ ç¼“å­˜ç­–ç•¥: çƒ­ç‚¹æ•°æ®è‡ªåŠ¨æ¨é€åˆ° CDN    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç›‘æ§å‘Šè­¦ç³»ç»Ÿ                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Prometheus + Grafana (æŒ‡æ ‡ç›‘æ§)     â”‚               â”‚
â”‚  â”‚ ELK Stack (æ—¥å¿—åˆ†æ)                â”‚               â”‚
â”‚  â”‚ Sentry (é”™è¯¯è¿½è¸ª)                   â”‚               â”‚
â”‚  â”‚ é’‰é’‰/ä¼ä¸šå¾®ä¿¡ (å‘Šè­¦æ¨é€)            â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° æˆæœ¬é¢„ä¼°ï¼ˆ100ä¸‡å¹¶å‘ï¼‰

### **äº‘æœåŠ¡å•†é€‰æ‹©ï¼šé˜¿é‡Œäº‘ï¼ˆæ¨èï¼‰**

| èµ„æºç±»å‹ | é…ç½® | æ•°é‡ | å•ä»· | æœˆæˆæœ¬ |
|---------|------|------|------|--------|
| **API ç½‘å…³** | 8æ ¸16G ECS | 40 å° | Â¥800/å° | Â¥32,000 |
| **ç”¨æˆ·æœåŠ¡** | 8æ ¸16G ECS | 50 å° | Â¥800/å° | Â¥40,000 |
| **è§†é¢‘æœåŠ¡** | 8æ ¸16G ECS | 100 å° | Â¥800/å° | Â¥80,000 |
| **æ”¯ä»˜æœåŠ¡** | 8æ ¸16G ECS | 30 å° | Â¥800/å° | Â¥24,000 |
| **ç¤¾äº¤æœåŠ¡** | 8æ ¸16G ECS | 50 å° | Â¥800/å° | Â¥40,000 |
| **æ•°æ®åº“ä¸»åº“** | 32æ ¸64G RDS | 1 å° | Â¥8,000/å° | Â¥8,000 |
| **æ•°æ®åº“ä»åº“** | 32æ ¸64G RDS | 4 å° | Â¥6,000/å° | Â¥24,000 |
| **Redis é›†ç¾¤** | 16G Ã— 10 èŠ‚ç‚¹ | 1 ç»„ | Â¥3,000/èŠ‚ç‚¹ | Â¥30,000 |
| **æ¶ˆæ¯é˜Ÿåˆ—** | Kafka é›†ç¾¤ | 5 èŠ‚ç‚¹ | Â¥2,000/èŠ‚ç‚¹ | Â¥10,000 |
| **Celery Workers** | 4æ ¸8G ECS | 300 å° | Â¥400/å° | Â¥120,000 |
| **è´Ÿè½½å‡è¡¡** | SLB é«˜çº§ç‰ˆ | 3 ä¸ª | Â¥3,000/ä¸ª | Â¥9,000 |
| **å¯¹è±¡å­˜å‚¨ OSS** | 3PB å­˜å‚¨ | - | Â¥0.12/GB | Â¥370,000 |
| **CDN æµé‡** | 500TB/æœˆ | - | Â¥0.20/GB | Â¥100,000 |
| **å¸¦å®½** | 10Gbps | - | Â¥80/Mbps | Â¥80,000 |
| **ç›‘æ§å‘Šè­¦** | ELK + ç›‘æ§ | 1 å¥— | Â¥10,000 | Â¥10,000 |
| **å¤‡ä»½å®¹ç¾** | å¼‚åœ°å¤šæ´» | - | - | Â¥30,000 |
| **å…¶ä»–** | åŸŸå/SSLç­‰ | - | - | Â¥5,000 |
| **ğŸ”¥ æ€»è®¡** | - | - | - | **Â¥1,012,000/æœˆ** |

### **å¹´æˆæœ¬ï¼šçº¦ 1,200ä¸‡äººæ°‘å¸** ğŸ’°

---

## ğŸ“‰ æˆæœ¬ä¼˜åŒ–æ–¹æ¡ˆ

### 1ï¸âƒ£ **åˆ†é˜¶æ®µæ‰©å®¹ï¼ˆæ¨èï¼‰**

| é˜¶æ®µ | ç”¨æˆ·æ•° | é…ç½® | æœˆæˆæœ¬ |
|------|--------|------|--------|
| **å½“å‰ï¼ˆå¼€å‘ï¼‰** | 0 | æœ¬åœ°å¼€å‘ | Â¥0 |
| **Beta æµ‹è¯•** | 1,000 | 2å°æœåŠ¡å™¨ | Â¥1,000 |
| **ä¸Šçº¿åˆæœŸ** | 10,000 | 5å°æœåŠ¡å™¨ | Â¥5,000 |
| **æˆé•¿æœŸ** | 50,000 | 20å°æœåŠ¡å™¨ | Â¥30,000 |
| **çˆ†å‘æœŸ** | 100,000 | 50å°æœåŠ¡å™¨ | Â¥80,000 |
| **ä¸­ç­‰è§„æ¨¡** | 500,000 | 150å°æœåŠ¡å™¨ | Â¥300,000 |
| **è¶…å¤§è§„æ¨¡** | **1,000,000** | **300å°æœåŠ¡å™¨** | **Â¥1,000,000** |

**ğŸ’¡ å…³é”®ç­–ç•¥ï¼šæŒ‰éœ€æ‰©å®¹ï¼Œä¸è¦ä¸€æ¬¡åˆ°ä½ï¼**

---

### 2ï¸âƒ£ **ä½¿ç”¨äº‘æœåŠ¡å•†ä¼˜æƒ **

```
âœ… é˜¿é‡Œäº‘åŒ…å¹´85æŠ˜: èŠ‚çœ Â¥180,000/å¹´
âœ… é¢„ç•™å®ä¾‹: èŠ‚çœ 30% = Â¥300,000/å¹´
âœ… Spot å®ä¾‹ï¼ˆWorkerèŠ‚ç‚¹ï¼‰: èŠ‚çœ 50% = Â¥720,000/å¹´
âœ… æµé‡åŒ…é¢„è´­: èŠ‚çœ 20% = Â¥240,000/å¹´

æ€»èŠ‚çœ: Â¥1,440,000/å¹´ (çº¦ 40%)
å®é™…å¹´æˆæœ¬: Â¥720ä¸‡ â†’ Â¥500ä¸‡
```

---

### 3ï¸âƒ£ **æŠ€æœ¯ä¼˜åŒ–é™ä½æˆæœ¬**

#### **ç¼“å­˜ä¼˜åŒ–**
```python
# æå‡ç¼“å­˜å‘½ä¸­ç‡åˆ° 98%
# å‡å°‘ 80% æ•°æ®åº“æŸ¥è¯¢
# èŠ‚çœ 50 å°æœåŠ¡å™¨ = Â¥40,000/æœˆ
```

#### **é™æ€èµ„æº CDN**
```python
# 90% è¯·æ±‚ç”± CDN å¤„ç†
# å‡å°‘ 200 å°æœåŠ¡å™¨ = Â¥160,000/æœˆ
```

#### **æ•°æ®åº“ä¼˜åŒ–**
```sql
-- è¯»å†™åˆ†ç¦» + åˆ†åº“åˆ†è¡¨
-- ä»åº“å¤„ç† 95% è¯»è¯·æ±‚
-- èŠ‚çœ 2 å°ä¸»åº“ = Â¥16,000/æœˆ
```

#### **å¼‚æ­¥åŒ–å¤„ç†**
```python
# è§†é¢‘ç”Ÿæˆå¼‚æ­¥åŒ–
# ä½¿ç”¨ Spot å®ä¾‹ï¼ˆç«ä»·å®ä¾‹ï¼‰
# èŠ‚çœ 50% = Â¥60,000/æœˆ
```

**æ€»ä¼˜åŒ–æ•ˆæœï¼šèŠ‚çœ Â¥280,000/æœˆ â‰ˆ 28%**

---

## ğŸš€ æ ¸å¿ƒæŠ€æœ¯æ–¹æ¡ˆ

### 1ï¸âƒ£ **å¾®æœåŠ¡æ¶æ„**

```python
# æœåŠ¡æ‹†åˆ†ï¼ˆæŒ‰ä¸šåŠ¡æ¨¡å—ï¼‰
services/
â”œâ”€â”€ user-service/          # ç”¨æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ æ³¨å†Œç™»å½•
â”‚   â”œâ”€â”€ ä¸ªäººä¿¡æ¯
â”‚   â””â”€â”€ æƒé™éªŒè¯
â”œâ”€â”€ video-service/         # è§†é¢‘æœåŠ¡
â”‚   â”œâ”€â”€ è§†é¢‘ç”Ÿæˆ
â”‚   â”œâ”€â”€ è§†é¢‘åˆ—è¡¨
â”‚   â””â”€â”€ è§†é¢‘è¯¦æƒ…
â”œâ”€â”€ payment-service/       # æ”¯ä»˜æœåŠ¡
â”‚   â”œâ”€â”€ ç§¯åˆ†å……å€¼
â”‚   â”œâ”€â”€ é‡‘å¸æç°
â”‚   â””â”€â”€ æœˆå¡è®¢é˜…
â”œâ”€â”€ social-service/        # ç¤¾äº¤æœåŠ¡
â”‚   â”œâ”€â”€ ç‚¹èµè¯„è®º
â”‚   â”œâ”€â”€ å…³æ³¨ç²‰ä¸
â”‚   â””â”€â”€ æ¶ˆæ¯é€šçŸ¥
â””â”€â”€ task-service/          # ä»»åŠ¡æœåŠ¡
    â”œâ”€â”€ ä»»åŠ¡ä¸­å¿ƒ
    â”œâ”€â”€ æ¯æ—¥ç­¾åˆ°
    â””â”€â”€ æ’è¡Œæ¦œ
```

---

### 2ï¸âƒ£ **æ•°æ®åº“åˆ†ç‰‡ç­–ç•¥**

```python
# users è¡¨åˆ†ç‰‡ï¼ˆæŒ‰ user_idï¼‰
def get_shard(user_id):
    return user_id % 10  # åˆ†10ä¸ªåº“
    
# ç¤ºä¾‹ï¼š
user_id = 123456
shard = 123456 % 10 = 6  # å­˜å…¥ db_6

# works è¡¨åˆ†è¡¨ï¼ˆæŒ‰æ—¶é—´ï¼‰
def get_table(created_at):
    return f"works_{created_at.strftime('%Y%m')}"
    
# ç¤ºä¾‹ï¼š
created_at = "2024-01-15"
table = "works_202401"  # å­˜å…¥ works_202401 è¡¨
```

---

### 3ï¸âƒ£ **ç¼“å­˜ç­–ç•¥ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰**

```python
# ç¬¬ä¸€çº§ï¼šæœ¬åœ°ç¼“å­˜ï¼ˆå•æœºï¼‰
@lru_cache(maxsize=1000)
def get_user_info_local(user_id):
    """æœ¬åœ°å†…å­˜ç¼“å­˜ï¼Œæå¿«ï¼Œä½†ä¸å…±äº«"""
    pass

# ç¬¬äºŒçº§ï¼šRedis ç¼“å­˜ï¼ˆåˆ†å¸ƒå¼ï¼‰
@redis_cache(expire=3600)  # 1å°æ—¶
def get_user_info_redis(user_id):
    """Redis ç¼“å­˜ï¼Œå…±äº«ï¼Œå‘½ä¸­ç‡é«˜"""
    pass

# ç¬¬ä¸‰çº§ï¼šæ•°æ®åº“ï¼ˆæºæ•°æ®ï¼‰
def get_user_info_db(user_id):
    """æ•°æ®åº“ï¼Œæœ€æ…¢ï¼Œæœ€åçš„å…œåº•"""
    pass

# æŸ¥è¯¢æµç¨‹
def get_user_info(user_id):
    # 1. å…ˆæŸ¥æœ¬åœ°ç¼“å­˜
    data = get_user_info_local(user_id)
    if data:
        return data
    
    # 2. å†æŸ¥ Redis
    data = get_user_info_redis(user_id)
    if data:
        return data
    
    # 3. æœ€åæŸ¥æ•°æ®åº“
    data = get_user_info_db(user_id)
    return data
```

---

### 4ï¸âƒ£ **é™æµç†”æ–­ç­–ç•¥**

```python
from fastapi import Request
from slowapi import Limiter
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)

# å…¨å±€é™æµï¼šæ¯ä¸ªIP 100 req/s
@app.get("/api/videos")
@limiter.limit("100/second")
async def get_videos():
    pass

# ç”¨æˆ·é™æµï¼šæ¯ä¸ªç”¨æˆ· 10ä¸ªè§†é¢‘ç”Ÿæˆ/å¤©
@app.post("/api/video/generate")
@limiter.limit("10/day", key_func=lambda: current_user.id)
async def generate_video():
    pass

# ç†”æ–­ç­–ç•¥
from circuitbreaker import circuit

@circuit(failure_threshold=10, recovery_timeout=60)
async def call_sora_api():
    """è°ƒç”¨Sora APIï¼Œå¤±è´¥10æ¬¡åç†”æ–­60ç§’"""
    pass
```

---

### 5ï¸âƒ£ **å¼‚åœ°å¤šæ´»æ¶æ„**

```
ä¸­å›½åŒºåŸŸåˆ†å¸ƒï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åä¸œï¼ˆä¸»ï¼‰  â”‚     â”‚  ååŒ—ï¼ˆå¤‡ï¼‰  â”‚     â”‚  åå—ï¼ˆå¤‡ï¼‰  â”‚
â”‚  ä¸Šæµ·/æ­å·   â”‚ â†â†’  â”‚  åŒ—äº¬       â”‚ â†â†’  â”‚  æ·±åœ³/å¹¿å·   â”‚
â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
â”‚  50% æµé‡    â”‚     â”‚  30% æµé‡    â”‚     â”‚  20% æµé‡    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   æ•°æ®åŒæ­¥         â”‚
                â”‚   (åŒå‘å¤åˆ¶)       â”‚
                â”‚   å»¶è¿Ÿ < 10ms      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# ç‰¹ç‚¹ï¼š
âœ… ä»»æ„ä¸€ä¸ªåŒºåŸŸæ•…éšœï¼Œå…¶ä»–åŒºåŸŸç»§ç»­æœåŠ¡
âœ… å°±è¿‘è®¿é—®ï¼Œé™ä½å»¶è¿Ÿ
âœ… å¼‚åœ°æ•°æ®å¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±
```

---

## ğŸ¯ Kubernetes è‡ªåŠ¨æ‰©ç¼©å®¹

```yaml
# k8s/video-service-hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: video-service-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: video-service
  minReplicas: 50      # æœ€å°‘ 50 ä¸ªå®ä¾‹
  maxReplicas: 500     # æœ€å¤š 500 ä¸ªå®ä¾‹
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70  # CPU > 70% æ—¶è‡ªåŠ¨æ‰©å®¹
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80  # å†…å­˜ > 80% æ—¶è‡ªåŠ¨æ‰©å®¹
  - type: Pods
    pods:
      metric:
        name: http_requests_per_second
      target:
        type: AverageValue
        averageValue: "1000"  # æ¯ä¸ªPod QPS > 1000 æ—¶æ‰©å®¹
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 60   # æ‰©å®¹å‰ç¨³å®š60ç§’
      policies:
      - type: Percent
        value: 50          # æ¯æ¬¡æ‰©å®¹ 50%
        periodSeconds: 60
      - type: Pods
        value: 10          # æˆ–æ¯æ¬¡å¢åŠ 10ä¸ªPod
        periodSeconds: 60
    scaleDown:
      stabilizationWindowSeconds: 300  # ç¼©å®¹å‰ç¨³å®š5åˆ†é’Ÿ
      policies:
      - type: Percent
        value: 20          # æ¯æ¬¡ç¼©å®¹ 20%
        periodSeconds: 60

---
# è‡ªåŠ¨æ‰©å®¹ç¤ºä¾‹ï¼š
# å½“å‰: 50 ä¸ª Pod
# CPU é£™å‡åˆ° 85%
# â†“
# è‡ªåŠ¨æ‰©å®¹: 50 â†’ 75 ä¸ª Pod (+50%)
# â†“
# å¦‚æœè¿˜ä¸å¤Ÿï¼Œç»§ç»­æ‰©å®¹: 75 â†’ 112 ä¸ª Pod
# â†“
# æœ€å¤šæ‰©å®¹åˆ° 500 ä¸ª Pod
# â†“
# æµé‡ä¸‹é™åï¼Œè‡ªåŠ¨ç¼©å®¹å› 50 ä¸ª Pod
```

---

## ğŸ“Š æ•°æ®åº“ä¼˜åŒ–æ–¹æ¡ˆ

### **è¯»å†™åˆ†ç¦» + åˆ†åº“åˆ†è¡¨**

```python
# database.py
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

# ä¸»åº“ï¼ˆå†™æ“ä½œï¼‰
master_engine = create_engine("postgresql://master:5432/skyriff")
MasterSession = sessionmaker(bind=master_engine)

# ä»åº“ï¼ˆè¯»æ“ä½œï¼‰- 4ä¸ªä»åº“
slave_engines = [
    create_engine(f"postgresql://slave{i}:5432/skyriff")
    for i in range(1, 5)
]

import random
def get_slave_session():
    """éšæœºé€‰æ‹©ä¸€ä¸ªä»åº“"""
    engine = random.choice(slave_engines)
    return sessionmaker(bind=engine)()

# ä½¿ç”¨ç¤ºä¾‹
def get_user(user_id):
    """è¯»æ“ä½œç”¨ä»åº“"""
    session = get_slave_session()
    return session.query(User).filter_by(id=user_id).first()

def create_user(user_data):
    """å†™æ“ä½œç”¨ä¸»åº“"""
    session = MasterSession()
    user = User(**user_data)
    session.add(user)
    session.commit()
    return user
```

### **åˆ†ç‰‡ç­–ç•¥ï¼ˆShardingï¼‰**

```python
# sharding.py
class DatabaseRouter:
    """æ•°æ®åº“åˆ†ç‰‡è·¯ç”±"""
    
    def get_shard(self, user_id):
        """æ ¹æ® user_id å†³å®šä½¿ç”¨å“ªä¸ªæ•°æ®åº“"""
        shard_count = 10  # 10ä¸ªåˆ†ç‰‡
        shard_id = user_id % shard_count
        return f"postgresql://db{shard_id}:5432/skyriff"
    
    def get_table(self, created_at):
        """æ ¹æ®æ—¶é—´å†³å®šä½¿ç”¨å“ªä¸ªè¡¨"""
        return f"works_{created_at.strftime('%Y%m')}"

# ä½¿ç”¨ç¤ºä¾‹
router = DatabaseRouter()

def get_user_works(user_id, created_at):
    """è·å–ç”¨æˆ·ä½œå“"""
    # 1. ç¡®å®šæ•°æ®åº“åˆ†ç‰‡
    db_url = router.get_shard(user_id)
    engine = create_engine(db_url)
    
    # 2. ç¡®å®šè¡¨å
    table_name = router.get_table(created_at)
    
    # 3. æŸ¥è¯¢
    query = f"""
        SELECT * FROM {table_name}
        WHERE user_id = {user_id}
        LIMIT 20
    """
    return engine.execute(query).fetchall()
```

---

## ğŸ”¥ æ€§èƒ½ä¼˜åŒ– Checklist

### **åç«¯ä¼˜åŒ–**
- [x] ä½¿ç”¨è¿æ¥æ± ï¼ˆæ•°æ®åº“ã€Redisï¼‰
- [x] API å“åº”å‹ç¼©ï¼ˆgzip/brotliï¼‰
- [x] å¼‚æ­¥å¤„ç†ï¼ˆCeleryï¼‰
- [x] æ‰¹é‡æ“ä½œï¼ˆå‡å°‘æ•°æ®åº“æŸ¥è¯¢ï¼‰
- [x] æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- [x] æ…¢æŸ¥è¯¢ç›‘æ§å’Œä¼˜åŒ–
- [x] ä»£ç æ€§èƒ½åˆ†æï¼ˆcProfileï¼‰

### **ç¼“å­˜ä¼˜åŒ–**
- [x] ä¸‰çº§ç¼“å­˜ï¼ˆæœ¬åœ°+Redis+DBï¼‰
- [x] ç¼“å­˜é¢„çƒ­ï¼ˆçƒ­ç‚¹æ•°æ®ï¼‰
- [x] ç¼“å­˜ç©¿é€é˜²æŠ¤ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰
- [x] ç¼“å­˜é›ªå´©é˜²æŠ¤ï¼ˆéšæœºè¿‡æœŸæ—¶é—´ï¼‰
- [x] ç¼“å­˜å‡»ç©¿é˜²æŠ¤ï¼ˆåˆ†å¸ƒå¼é”ï¼‰

### **æ•°æ®åº“ä¼˜åŒ–**
- [x] ä¸»ä»å¤åˆ¶ï¼ˆè¯»å†™åˆ†ç¦»ï¼‰
- [x] åˆ†åº“åˆ†è¡¨ï¼ˆShardingï¼‰
- [x] ç´¢å¼•ä¼˜åŒ–
- [x] è¿æ¥æ± 
- [x] æ…¢æŸ¥è¯¢æ—¥å¿—
- [x] å®šæœŸæ¸…ç†å†å²æ•°æ®

### **å‰ç«¯ä¼˜åŒ–**
- [x] ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰
- [x] æ‡’åŠ è½½ï¼ˆLazy Loadingï¼‰
- [x] å›¾ç‰‡å‹ç¼©å’Œ WebP æ ¼å¼
- [x] CDN åŠ é€Ÿ
- [x] æµè§ˆå™¨ç¼“å­˜
- [x] Gzip å‹ç¼©

### **ç½‘ç»œä¼˜åŒ–**
- [x] HTTP/2 æˆ– HTTP/3
- [x] CDN å…¨çƒåŠ é€Ÿ
- [x] åŸŸååˆ†ç‰‡
- [x] DNS é¢„è§£æ
- [x] é•¿è¿æ¥ï¼ˆKeep-Aliveï¼‰

---

## ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤æ–¹æ¡ˆ

### **DDoS é˜²æŠ¤**
```python
# ä½¿ç”¨äº‘æœåŠ¡å•†çš„ DDoS é˜²æŠ¤
# - é˜¿é‡Œäº‘ DDoS é«˜é˜²
# - æŠ— 100Gbps+ æ”»å‡»
# - è‡ªåŠ¨æ¸…æ´—æ¶æ„æµé‡
```

### **CC æ”»å‡»é˜²æŠ¤**
```python
# API é™æµ
from slowapi import Limiter

# æ¯ä¸ª IP é™åˆ¶ 100 req/s
@limiter.limit("100/second")
async def api_endpoint():
    pass

# æ»‘åŠ¨çª—å£é™æµ
from redis import Redis
redis = Redis()

def check_rate_limit(user_id, max_requests=1000, window=60):
    """æ»‘åŠ¨çª—å£é™æµï¼š60ç§’å†…æœ€å¤š1000æ¬¡è¯·æ±‚"""
    key = f"rate_limit:{user_id}"
    current_time = time.time()
    
    # ç§»é™¤è¿‡æœŸçš„è¯·æ±‚è®°å½•
    redis.zremrangebyscore(key, 0, current_time - window)
    
    # è·å–å½“å‰è¯·æ±‚æ•°
    request_count = redis.zcard(key)
    
    if request_count >= max_requests:
        raise Exception("è¯·æ±‚è¿‡äºé¢‘ç¹")
    
    # è®°å½•æœ¬æ¬¡è¯·æ±‚
    redis.zadd(key, {current_time: current_time})
    redis.expire(key, window)
```

### **SQL æ³¨å…¥é˜²æŠ¤**
```python
# ä½¿ç”¨ ORMï¼ˆSQLAlchemyï¼‰è‡ªåŠ¨é˜²æŠ¤
from sqlalchemy.orm import Session

# âœ… å®‰å…¨ï¼šå‚æ•°åŒ–æŸ¥è¯¢
def get_user(db: Session, user_id: int):
    return db.query(User).filter(User.id == user_id).first()

# âŒ å±é™©ï¼šå­—ç¬¦ä¸²æ‹¼æ¥
def get_user_unsafe(db: Session, user_id: str):
    query = f"SELECT * FROM users WHERE id = {user_id}"  # SQLæ³¨å…¥é£é™©ï¼
    return db.execute(query)
```

### **XSS é˜²æŠ¤**
```python
# å‰ç«¯ï¼šä½¿ç”¨ React è‡ªåŠ¨è½¬ä¹‰
<div>{user.name}</div>  # React è‡ªåŠ¨è½¬ä¹‰ï¼Œå®‰å…¨

# åç«¯ï¼šè¾“å…¥éªŒè¯
from pydantic import BaseModel, validator

class UserCreate(BaseModel):
    name: str
    
    @validator('name')
    def validate_name(cls, v):
        # ç¦æ­¢ç‰¹æ®Šå­—ç¬¦
        if '<' in v or '>' in v:
            raise ValueError('åç§°ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦')
        return v
```

---

## ğŸ“ˆ ç›‘æ§å‘Šè­¦ç³»ç»Ÿ

### **æ ¸å¿ƒæŒ‡æ ‡ç›‘æ§**

```python
# Prometheus + Grafana

# 1. QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰
rate(http_requests_total[1m])

# 2. å“åº”æ—¶é—´ï¼ˆP50, P95, P99ï¼‰
histogram_quantile(0.50, http_request_duration_seconds)
histogram_quantile(0.95, http_request_duration_seconds)
histogram_quantile(0.99, http_request_duration_seconds)

# 3. é”™è¯¯ç‡
rate(http_requests_total{status=~"5.."}[1m]) / rate(http_requests_total[1m])

# 4. æ•°æ®åº“è¿æ¥æ•°
db_connections_active / db_connections_max

# 5. Redis å‘½ä¸­ç‡
redis_keyspace_hits / (redis_keyspace_hits + redis_keyspace_misses)

# 6. CPU å’Œå†…å­˜ä½¿ç”¨ç‡
node_cpu_usage
node_memory_usage

# 7. é˜Ÿåˆ—é•¿åº¦
celery_queue_length
```

### **å‘Šè­¦è§„åˆ™**

```yaml
# prometheus-alerts.yml
groups:
- name: skyriff-alerts
  rules:
  # CPU å‘Šè­¦
  - alert: HighCPUUsage
    expr: node_cpu_usage > 80
    for: 5m
    annotations:
      summary: "æœåŠ¡å™¨ CPU ä½¿ç”¨ç‡è¶…è¿‡ 80%"
      description: "{{ $labels.instance }} CPU ä½¿ç”¨ç‡ {{ $value }}%"
  
  # å†…å­˜å‘Šè­¦
  - alert: HighMemoryUsage
    expr: node_memory_usage > 85
    for: 5m
    annotations:
      summary: "æœåŠ¡å™¨å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡ 85%"
  
  # å“åº”æ—¶é—´å‘Šè­¦
  - alert: SlowResponse
    expr: histogram_quantile(0.95, http_request_duration_seconds) > 1
    for: 5m
    annotations:
      summary: "API å“åº”æ—¶é—´è¿‡æ…¢ï¼ˆP95 > 1sï¼‰"
  
  # é”™è¯¯ç‡å‘Šè­¦
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.01
    for: 5m
    annotations:
      summary: "é”™è¯¯ç‡è¶…è¿‡ 1%"
  
  # æ•°æ®åº“è¿æ¥æ•°å‘Šè­¦
  - alert: DatabaseConnectionsHigh
    expr: db_connections_active / db_connections_max > 0.8
    for: 5m
    annotations:
      summary: "æ•°æ®åº“è¿æ¥æ•°ä½¿ç”¨ç‡è¶…è¿‡ 80%"
```

---

## ğŸ¯ æ€»ç»“ï¼š100ä¸‡å¹¶å‘æ–¹æ¡ˆ

### **æ¶æ„è¦ç‚¹**
1. âœ… **å¾®æœåŠ¡æ¶æ„**ï¼šæŒ‰ä¸šåŠ¡æ‹†åˆ†æœåŠ¡
2. âœ… **æ•°æ®åº“åˆ†ç‰‡**ï¼šè¯»å†™åˆ†ç¦» + åˆ†åº“åˆ†è¡¨
3. âœ… **ä¸‰çº§ç¼“å­˜**ï¼šæœ¬åœ° + Redis + æ•°æ®åº“
4. âœ… **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šå¼‚æ­¥å¤„ç†ï¼Œå‰Šå³°å¡«è°·
5. âœ… **è´Ÿè½½å‡è¡¡**ï¼šå¤šçº§è´Ÿè½½ï¼Œæµé‡åˆ†å‘
6. âœ… **CDN åŠ é€Ÿ**ï¼šé™æ€èµ„æºå…¨çƒåŠ é€Ÿ
7. âœ… **è‡ªåŠ¨æ‰©ç¼©å®¹**ï¼šK8s è‡ªåŠ¨è°ƒæ•´å®ä¾‹æ•°
8. âœ… **å¼‚åœ°å¤šæ´»**ï¼šå¤šåœ°åŸŸéƒ¨ç½²ï¼Œé«˜å¯ç”¨

### **æˆæœ¬**
- **æ»¡é…æˆæœ¬**ï¼šÂ¥100ä¸‡/æœˆï¼ˆÂ¥1,200ä¸‡/å¹´ï¼‰
- **ä¼˜åŒ–åæˆæœ¬**ï¼šÂ¥50ä¸‡/æœˆï¼ˆÂ¥600ä¸‡/å¹´ï¼‰
- **åˆ†é˜¶æ®µæ‰©å®¹**ï¼šä» Â¥5,000/æœˆ å¼€å§‹ï¼Œé€æ­¥å¢é•¿

### **ç°å®å»ºè®®**
1. **ä¸è¦ä¸€æ¬¡åˆ°ä½**ï¼š100ä¸‡ç”¨æˆ·ä¸æ˜¯ä¸€å¤œä¹‹é—´è¾¾åˆ°çš„
2. **åˆ†é˜¶æ®µæ‰©å®¹**ï¼š
   - 1ä¸‡ç”¨æˆ·ï¼šÂ¥5,000/æœˆ
   - 10ä¸‡ç”¨æˆ·ï¼šÂ¥50,000/æœˆ
   - 100ä¸‡ç”¨æˆ·ï¼šÂ¥500,000/æœˆ
3. **æŠ€æœ¯ä¼˜åŒ–å…ˆè¡Œ**ï¼šä¼˜åŒ–ä»£ç å’Œæ¶æ„ï¼Œå‡å°‘æœåŠ¡å™¨æ•°é‡
4. **ä½¿ç”¨äº‘æœåŠ¡å•†ä¼˜æƒ **ï¼šé¢„ç•™å®ä¾‹ã€Spotå®ä¾‹ã€æµé‡åŒ…

### **å…³é”®æŒ‡æ ‡**
- **æ¯å°æœåŠ¡å™¨æ”¯æŒ**ï¼š3,000-5,000 å¹¶å‘
- **100ä¸‡å¹¶å‘éœ€è¦**ï¼š200-300 å°æœåŠ¡å™¨
- **æ•°æ®åº“**ï¼š1ä¸»4ä» + åˆ†åº“åˆ†è¡¨
- **ç¼“å­˜**ï¼šRedis é›†ç¾¤ 10èŠ‚ç‚¹
- **CDN**ï¼šå¤„ç† 90% é™æ€è¯·æ±‚

---

## ğŸ’¡ æœ€é‡è¦çš„ä¸€å¥è¯

**"100ä¸‡ç”¨æˆ·æ˜¯æ…¢æ…¢ç§¯ç´¯çš„ï¼Œæ¶æ„ä¹Ÿæ˜¯é€æ­¥å‡çº§çš„ï¼"**

**ç°åœ¨ä¸“æ³¨å¼€å‘ï¼Œä¸Šçº¿åæ ¹æ®å®é™…æƒ…å†µåˆ†é˜¶æ®µæ‰©å®¹ï¼** ğŸš€
