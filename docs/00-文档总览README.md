# SkyRiff 开发文档总览

> **项目名称**：SkyRiff AI视频社交平台  
> **文档版本**：v1.0  
> **最后更新**：2025-12-25  
> **文档状态**：✅ 已定稿，可直接开发

---

## 📚 文档清单

### 1. [产品需求文档（PRD）](./01-产品需求文档-PRD.md)
**适合人群**：产品经理、开发、设计、测试

**内容概要**：
- ✅ 产品定位与核心价值
- ✅ 用户角色与权限
- ✅ 5大功能模块详解（首页/工具/创作/资产/我的）
- ✅ 双钱包经济系统（Credits积分 + Coins金币）
- ✅ 充值档位与月卡设计
- ✅ 创作者收益体系（打赏/提示词/二创/商单）
- ✅ 推广员分佣系统
- ✅ 任务中心激励系统
- ✅ 视频生成参数（时长/比例/模型）
- ✅ 内容分发算法（发现/热门/排行）
- ✅ UI/UX设计规范
- ✅ 开发优先级（Phase 0-4）

**关键数据**：
- 充值汇率：1元 = 20积分
- 生成费用：10秒=10、15秒=15、25秒=25积分
- 无水印下载：6积分
- 月卡：29元/月，每日领30积分
- 打赏档位：10/20/50/100积分
- 平台抽成：创作收益10%、商单5%
- 冻结期：所有收入7天后可提

---

### 2. [技术架构文档](./02-技术架构文档.md)
**适合人群**：技术负责人、架构师、后端开发

**内容概要**：
- ✅ 整体架构图（客户端/网关/应用/数据/第三方）
- ✅ 技术栈选型（FastAPI + PostgreSQL + Redis + Celery）
- ✅ 完整数据库设计（30+张表，包含字段/索引/约束）
- ✅ API接口设计规范（RESTful + JWT认证）
- ✅ 供应商对接（Sora2 API Adapter层）
- ✅ 安全设计（认证/授权/数据加密/防刷）
- ✅ 性能优化（缓存/数据库/CDN/异步）
- ✅ 监控与运维（日志/告警/部署）

**核心表结构**：
- 用户体系：users、user_stats、follows
- 钱包体系：credit_wallets、credit_ledgers、coin_wallets、coin_ledgers
- 视频体系：tasks、video_assets、works、work_stats
- 社交体系：likes、favorites、comments（预留）
- 财务体系：products、payments、subscriptions、withdrawals
- 推广体系：referral_codes、referral_bindings
- 任务体系：task_definitions、daily_task_assignments

---

### 3. [API接口规格文档](./03-API接口规格文档.md)
**适合人群**：前端开发、后端开发、测试

**内容概要**：
- ✅ 统一响应格式与错误码
- ✅ 60+个接口详细定义（请求/响应示例）
- ✅ 认证模块（手机/微信登录）
- ✅ 用户模块（资料/主页/关注）
- ✅ 钱包模块（余额/流水）
- ✅ 创作模块（上传/生成任务）
- ✅ 资产模块（视频/项目/下载）
- ✅ 作品模块（发布/Feed/点赞/打赏/解锁/二创）
- ✅ 收藏模块（收藏列表/操作）
- ✅ 充值模块（商品/支付）
- ✅ 月卡模块（购买/领取）
- ✅ 任务中心（今日任务/领取）
- ✅ 推广模块（激活/绑定/信息）
- ✅ 提现模块（申请/记录）
- ✅ 排行榜（打赏Top10）

**接口示例**：
```
POST /api/v1/tasks/create
GET  /api/v1/feed?tab=discover
POST /api/v1/works/{work_id}/tip_and_favorite
POST /api/v1/subscriptions/claim_daily
```

---

### 4. [开发优先级清单](./04-开发优先级清单.md)
**适合人群**：项目经理、技术负责人、程序小白

**内容概要**：
- ✅ Phase 0：基础设施（1-2天）
  - 用户登录、三钱包、产品配置
- ✅ Phase 1：核心闭环（3-7天）
  - 视频生成、任务轮询、资产管理、无水印下载
- ✅ Phase 2：内容增长（7-14天）
  - 发布作品、Feed、关注、打赏并收藏、提示词、二创
- ✅ Phase 3：留存与变现（14-21天）
  - 充值、月卡、任务中心、排行榜、提现
- ✅ Phase 4：商单系统（后期）
  - 发布/接单/交付/验收/托管

**每阶段包含**：
- 目标与成果
- 详细任务清单（带代码示例）
- 验收标准
- 关键技术点速查

**适合谁**：
- ✅ 不懂技术的产品经理：看每个阶段的"目标"和"验收标准"
- ✅ 技术负责人：看"任务清单"和"代码示例"
- ✅ 外包团队：直接按清单开发

---

### 5. [业务规则配置文档](./05-业务规则配置文档.md) ⚙️
- 货币体系（Credits/Coins定义、汇率、用途）
- 充值档位表（7个档位）
- 月卡规则
- 视频生成费用表
- 模型映射表
- 创作者收益计算公式
- 推广员分佣规则
- 任务中心配置（11个任务定义）
- 提现规则
- 商单规则
- 安全限制
- 数据库初始化SQL脚本

### 6. [供应商API对接文档](./06-供应商API对接文档.md) 🔌
- DyuAPI Sora2完整接口文档
- 8个接口详细说明（请求/响应示例）
- 完整Adapter代码（可直接使用）
- 模型名称映射表
- 状态码映射表
- 请求流程图解
- 错误处理方案
- 环境配置说明
- 测试建议

### 7. [快速启动指南](./07-快速启动指南.md) 🚀
- 10分钟快速启动流程
- 从零搭建后端项目
- 完整代码示例（复制即用）
- 启动验证清单
- 常见启动问题解决
- 测试接口说明
- 生产环境部署检查

### 8. [常见问题FAQ](./08-常见问题FAQ.md) ❓
- 产品设计类（15个问题）
- 技术实现类（10个问题）
- 业务规则类（10个问题）
- 运营策略类（5个问题）
- 供应商对接类（3个问题）
- 前端对接类（2个问题）
- 部署运维类（2个问题）

### 9. [项目结构建议](./09-项目结构建议.md) 🏗️
- 完整项目目录结构（后端/前端/移动端）
- 各目录详细说明与示例代码
- 环境变量配置模板
- Docker部署配置
- Git分支策略
- 代码规范与工具推荐
- 常用开发命令
- 生产环境部署清单

---

## 🎯 快速开始

### 给产品经理
1. 先看 **[产品需求文档](./01-产品需求文档-PRD.md)** 了解全貌
2. 再看 **[业务规则配置文档](./05-业务规则配置文档.md)** 确认所有数值
3. 最后看 **[开发优先级清单](./04-开发优先级清单.md)** 了解开发计划

### 给技术负责人
1. 先看 **[开发优先级清单](./04-开发优先级清单.md)** 了解分阶段任务
2. 再看 **[技术架构文档](./02-技术架构文档.md)** 确定技术选型
3. 然后看 **[API接口规格文档](./03-API接口规格文档.md)** 设计接口
4. 最后看 **[业务规则配置文档](./05-业务规则配置文档.md)** 写代码

### 给前端开发
1. 直接看 **[API接口规格文档](./03-API接口规格文档.md)**
2. 参考 **[产品需求文档](./01-产品需求文档-PRD.md)** 的UI/UX规范
3. 需要业务逻辑时查 **[业务规则配置文档](./05-业务规则配置文档.md)**

### 给后端开发
1. 先看 **[技术架构文档](./02-技术架构文档.md)** 的数据库设计
2. 再看 **[API接口规格文档](./03-API接口规格文档.md)** 实现接口
3. 参考 **[开发优先级清单](./04-开发优先级清单.md)** 的代码示例
4. 查 **[业务规则配置文档](./05-业务规则配置文档.md)** 写业务逻辑

### 给测试
1. 先看 **[产品需求文档](./01-产品需求文档-PRD.md)** 了解功能
2. 再看 **[开发优先级清单](./04-开发优先级清单.md)** 的验收标准
3. 参考 **[API接口规格文档](./03-API接口规格文档.md)** 写测试用例
4. 用 **[业务规则配置文档](./05-业务规则配置文档.md)** 验证数据

---

## 📊 核心数据速查表

### 充值档位
| 金额 | 积分 | 视频数 |
|------|------|--------|
| 6元 | 120 | 12个 |
| 30元 | 600 | 60个 |
| 68元 | 1360 | 136个 |
| 128元 | 2560 | 256个 |
| 328元 | 6560 | 656个 |
| 648元 | 12960 | 1296个 |
| 2880元 | 57600 | 5760个 |

### 消费定价
| 项目 | 积分 |
|------|------|
| 生成10秒 | 10 |
| 生成15秒 | 15 |
| 生成25秒 | 25 |
| 无水印下载 | 6 |
| 解锁提示词 | 5 |
| 二创额外费 | 2 |

### 打赏档位
| 档位 | 积分 | 创作者收入 |
|------|------|-----------|
| 小额 | 10 | 0.45元 |
| 中额 | 20 | 0.90元 |
| 大额 | 50 | 2.25元 |
| 超大 | 100 | 4.50元 |

### 月卡
- **价格**：29元
- **权益**：30天内每日可领30积分
- **领取**：手动点击领取

### 推广员
- **激活**：充值30元
- **奖励**：600积分 + 推广码
- **直接分佣**：5%（实时，冻结7天）
- **二级分佣**：0.1%（月结，冻结7天）

### 任务中心
- **每日任务数**：3个
- **每个奖励**：2积分
- **领取方式**：手动点击

### 提现规则
- **最低提现**：100元
- **冻结期**：所有收入7天后可提
- **手续费**：0元

---

## 🔥 关键业务逻辑

### 1. 生成任务扣费流程
```python
# 创建任务时预扣
credit_wallet.balance -= cost
credit_ledger(type="gen_hold", amount=-cost)

# 成功 → 不退款
task.status = "SUCCESS"

# 失败 → 自动退款
credit_wallet.balance += cost
credit_ledger(type="gen_refund", amount=+cost)
```

### 2. 打赏并收藏流程
```python
# 1. 扣付费者积分
credit_wallet.balance -= amount_credits

# 2. 创作者收入（冻结7天）
creator_coins = amount_credits × 90% × 0.05
coin_wallet.pending_coins += creator_coins
coin_ledger(status="pending", unlock_at=now()+7天)

# 3. 自动收藏
Favorite.create(user_id, work_id)
```

### 3. 无水印下载权限校验
```python
# 必须是视频所有者
if video.owner_user_id != current_user_id:
    raise PermissionDenied

# 扣费6积分
credit_wallet.balance -= 6

# 返回临时签名URL（不返回直链）
signed_url = generate_signed_url(expire=1h)
```

---

## ✅ 文档完整性检查

### 产品层面
- [x] 功能模块全覆盖（首页/工具/创作/资产/我的）
- [x] 用户角色与权限明确
- [x] 经济系统完整（Credits + Coins）
- [x] 变现路径清晰（充值/月卡/打赏/商单）
- [x] 激励系统完善（任务中心/推广员）
- [x] UI/UX规范定义

### 技术层面
- [x] 架构设计完整（6层架构）
- [x] 数据库设计完整（30+张表）
- [x] API接口完整（60+个接口）
- [x] 供应商对接方案明确
- [x] 安全方案完整
- [x] 性能优化方案

### 开发层面
- [x] 分阶段开发计划（Phase 0-4）
- [x] 每阶段任务清单
- [x] 验收标准明确
- [x] 代码示例充足
- [x] 初始化SQL脚本

### 业务层面
- [x] 所有费用定价
- [x] 所有分成比例
- [x] 所有时间配置
- [x] 所有限制规则
- [x] 所有计算公式

---

## 🚀 下一步行动

### 1. 立即可做
- [ ] 搭建开发环境（FastAPI + PostgreSQL + Redis）
- [ ] 创建数据库并执行初始化SQL
- [ ] 注册供应商账号（DyuAPI Sora2）
- [ ] 申请支付通道（微信/支付宝）
- [ ] 准备短信服务（验证码）

### 2. Phase 0开发（1-2天）
- [ ] 实现手机验证码登录
- [ ] 创建三钱包表并初始化
- [ ] 插入充值档位数据
- [ ] 实现余额查询接口

### 3. Phase 1开发（3-7天）
- [ ] 对接Sora2 API
- [ ] 实现视频生成任务
- [ ] 实现任务轮询机制
- [ ] 实现无水印下载

### 4. 并行工作
- **产品**：准备运营素材、设计活动
- **前端**：开发UI组件、对接API
- **测试**：编写测试用例、准备测试数据
- **运营**：准备示例视频、种子用户

---

## 📞 联系与反馈

**文档维护**：SkyRiff产品团队  
**文档版本**：v1.0  
**最后更新**：2025-12-25  

**反馈渠道**：
- 产品问题：联系产品经理
- 技术问题：联系技术负责人
- 文档问题：提交Issue

---

**⚡ 重要提示**：
1. ✅ 所有文档已定稿，所有数值已确定，可直接开发
2. ✅ 如需调整参数，请先更新文档再同步代码
3. ✅ 开发过程中遇到问题，先查文档，再问人
4. ✅ 建议按Phase 0→1→2→3→4顺序开发，不要跳跃
5. ✅ 每个Phase完成后进行验收，确保质量

**祝开发顺利！🎉**