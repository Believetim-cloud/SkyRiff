# SkyRiff AI视频社交平台 - 产品需求文档（PRD）v1.0

## 一、产品概述

### 1.1 产品定位
SkyRiff是一个面向创作者的AI视频创作与社交平台，集成Sora2视频生成能力，为用户提供：
- AI视频生成（文生视频/图生视频）
- 短视频社交分享
- 创作者收益体系
- 推广员分佣系统

### 1.2 核心价值
- **创作者**：低门槛创作高质量AI视频，通过作品获得收益
- **消费者**：发现优质AI视频内容，支持喜欢的创作者
- **推广员**：邀请新用户，获得持续佣金收入
- **平台**：构建AI视频生态，实现内容变现闭环

### 1.3 产品形态
- **iOS风格深色主题设计**
- **5个主Tab页面**：首页、工具、创作、资产、我的
- **全屏沉浸式视频播放**（类抖音体验）
- **完整的积分/金币双钱包体系**

---

## 二、用户角色与权限

### 2.1 用户角色
| 角色 | 说明 | 权限 |
|------|------|------|
| 普通用户 | 注册用户 | 生成视频、浏览内容、点赞收藏 |
| 创作者 | 发布过作品的用户 | 普通用户权限 + 接收打赏/提示词收入/二创分成 |
| 推广员 | 充值30元激活 | 普通用户权限 + 邀请码分佣 |
| 商单发布者 | 充值金币的用户 | 发布商单、托管金币、验收作品 |

### 2.2 用户成长路径
```
新用户注册
    ↓
[可选] 填写邀请码 → 获得50积分
    ↓
首次生成视频（消耗10积分）
    ↓
发布作品 → 自动成为创作者
    ↓
[可选] 充值30元 → 成为推广员
```

---

## 三、核心功能模块

### 3.1 底部导航结构
```
┌─────────────────────────────────────┐
│  首页   工具   创作   资产   我的   │
└─────────────────────────────────────┘
```

#### 首页（发现/热门/排行）
- **发现**：智能推荐算法，全屏视频流
- **热门**：24小时热门作品（按点赞数排序）
- **排行**：创作者打赏排行Top10

**交互功能**：
- 上下滑动切换视频
- 点击屏幕暂停/播放
- 点赞、打赏并收藏、分享
- 解锁提示词（5积分）
- 二次创作（2积分 + 生成费用）
- 点击头像进入用户主页
- 关注/取关创作者

#### 工具页
- **扩展分镜**：批量创建多个视频任务
- **故事版**：生成8条镜头结构，批量提交生成
- **商单入口**：发布者发单、创作者接单（后期）

#### 创作页
- **文生视频**：输入提示词生成视频
- **图生视频**：上传参考图 + 提示词生成视频
- **参数选择**：
  - 时长：10秒/15秒/25秒
  - 比例：9:16竖屏 / 16:9横屏 / 1:1方形
  - 模型：Sora2基础版 / Sora2Pro高级版
  - 项目：选择项目分类或创建新项目

#### 资产页
- **视频资产**：我生成的所有视频
  - 生成中（显示进度条）
  - 生成成功（可播放水印版）
  - 生成失败（显示失败原因，可重试）
- **收藏**：我收藏的作品
- **角色资产**：我的角色库（预留）
- **项目**：文件夹分类管理

**资产操作**：
- 播放预览（水印版免费）
- 无水印下载（扣6积分，仅限本人）
- 发布到视频池（一键发布作品）
- 删除视频

#### 我的页（个人主页）
- **个人信息**：头像、昵称、ID、简介
- **统计数据**：获赞数、粉丝数
- **钱包卡片**：
  - 积分余额（生成/消费用）
  - 金币余额（可提现，分为可用/冻结）
- **任务卡片**：获取积分入口（每日3个任务）
- **作品Tabs**：
  - 已发布：我发布的公开作品
  - 赞过：我点赞的作品（预留）
  - 收藏：我收藏的作品

---

## 四、经济系统设计

### 4.1 双钱包体系

#### Credits（积分）- 消费货币
- **用途**：生成视频、下载无水印、解锁提示词、二创、打赏
- **获取方式**：
  1. 充值购买（1元=20积分）
  2. 月卡每日领取（30积分/天）
  3. 任务奖励（每个任务2积分）
  4. 新用户绑定邀请码赠送（50积分）
- **不可提现**

#### Coins（金币）- 收益货币
- **用途**：创作者收益、推广佣金、商单收入
- **来源**：
  1. 打赏收入（扣除10%平台抽成）
  2. 提示词解锁收入（扣除10%平台抽成）
  3. 二创分成收入（扣除10%平台抽成）
  4. 商单收入（扣除5%平台抽成）
  5. 推广佣金（直接5% + 二级0.1%月结）
- **可提现**：满100元起提，**所有收入冻结7天后可提**
- **兑换比例**：1 coin = 1 RMB

### 4.2 充值档位
| 金额 | 积分 | 可生成10秒视频数 |
|------|------|------------------|
| 6元  | 120  | 12个 |
| 30元 | 600  | 60个 |
| 68元 | 1360 | 136个 |
| 128元 | 2560 | 256个 |
| 328元 | 6560 | 656个 |
| 648元 | 12960 | 1296个 |
| 2880元 | 57600 | 5760个 |

**充值汇率**：1元 = 20积分（统一）

### 4.3 月卡
- **价格**：29元/月
- **权益**：30天内每日可手动领取30积分
- **领取规则**：
  - 每天最多领取1次
  - 必须手动点击"领取"按钮
  - 未领取不可补领
  - 月卡到期后不可领取

### 4.4 消费定价
| 消费项 | 积分 | 说明 |
|--------|------|------|
| 生成10秒视频 | 10 | 文生/图生统一 |
| 生成15秒视频 | 15 | 文生/图生统一 |
| 生成25秒视频 | 25 | 仅Sora2Pro支持 |
| 无水印下载 | 6 | 仅限下载自己的视频 |
| 解锁提示词 | 5 | 一次付费永久查看 |
| 二创额外费 | 2 | 在生成费用基础上额外收取 |
| 打赏 | 10/20/50/100 | 用户自选档位 |

### 4.5 创作者收益规则

#### 收益来源
1. **打赏收入**：90%归创作者（10%平台抽成）
2. **提示词解锁**：90%归创作者（5积分 × 90% = 4.5积分等值金币）
3. **二创分成**：90%归创作者（2积分 × 90% = 1.8积分等值金币）
4. **商单收入**：95%归创作者（5%平台抽成）

#### 积分→金币换算
- 创作者收到的积分收入，按汇率转为金币
- 建议汇率：1积分 = 0.05 coin（即20积分=1元=1coin）
- 示例：用户打赏20积分 → 创作者收入18积分 → 转为0.9 coin

#### 冻结机制
**所有收入冻结7天后可提现**，包括：
- 打赏收入
- 提示词收入
- 二创收入
- 商单收入
- 推广佣金

**钱包结构**：
- `coins_available`：可提现余额
- `coins_pending`：冻结中余额（带解冻时间）

#### 提现规则
- **最低提现**：100元
- **提现方式**：银行卡/支付宝/微信
- **到账时间**：1-3个工作日

---

## 五、社交互动功能

### 5.1 作品互动
| 功能 | 说明 | 规则 |
|------|------|------|
| 点赞 | 用于热榜/推荐算法 | 免费，可撤销，不进资产 |
| 打赏并收藏 | 一键完成打赏+收藏 | 选择档位（10/20/50/100），收藏作品进入资产页 |
| 分享 | 复制作品链接 | 免费 |
| 解锁提示词 | 查看作品提示词 | 5积分，一次付费永久查看 |
| 二次创作 | 基于作品二创 | 2积分分成给原作者 + 生成费用 |

### 5.2 用户互动
- **关注/取关**：头像下方"+"按钮
- **查看主页**：点击头像进入
  - 显示：获赞数、粉丝数、关注数、作品数
  - 作品列表：已发布作品Grid，显示点赞数
- **粉丝/关注列表**：点击统计数字进入

### 5.3 作品卡信息
- **作品封面**：视频首帧缩略图
- **作品标题**：发布时填写
- **点赞数**：实时更新
- **打赏数**：累计打赏次数
- **收藏数**：被收藏次数
- **播放数**：浏览次数

---

## 六、任务中心系统

### 6.1 核心规则
- **每日任务数**：3个
- **任务奖励**：每个2积分
- **领取方式**：手动点击"领取"
- **刷新机制**：每天0点刷新

### 6.2 务分类

#### 活跃类
- 每日登录��login_daily）

#### 创作类
- 生成视频成功（gen_success）
- 发布作品（publish_work）
- 二次创作（remix_work）

#### 互动类
- 点赞作品（like_work）
- 关注用户（follow_user）
- 打赏并收藏（tip_and_favorite）

#### 消费引导类
- 解锁提示词（unlock_prompt）

#### 新手成长类（一次性）
- 完善资料（complete_profile）
- 首次生成（first_gen）
- 首次发布（first_publish）

### 6.3 任务分配策略
每日自动分配3个任务：
1. 1个基础活跃类（如每日登录）
2. 1个创作类（随机）
3. 1个互动类（随机）

---

## 七、推广员系统

### 7.1 成为推广员
- **激活条件**：充值30元
- **激活奖励**：
  - 获得推广积分600（可用于生成）
  - 生成专属邀请码

### 7.2 推广奖励

#### 新用户奖励
- 新用户绑定邀请码：获得50积分（新手赠送）

#### 直接分佣（一级）
- **佣金比例**：5%
- **触发时机**：被邀请人每次充值（积分或金币）
- **结算方式**：实时到账金币，冻结7天
- **示例**：被邀请人充值100元 → 推广员获得5元（5 coins）

#### 二级分佣（月结）
- **佣金比例**：0.1%
- **触发条件**：被邀请人成为推广员并产生推广收入
- **结算方式**：每月1号跑批上月数据
- **示例**：A邀请B，B邀请C，C充值1000元 → A获得1元（1 coin）

### 7.3 推广员中心
- 查看邀请码
- 查看推广数据：邀请人数、累计佣金
- 查看佣金明细：来源、时间、金额
- 提现入口（统一金币提现）

---

## 八、商单系统（Phase 4）

### 8.1 发布商单
- **发布者**：充值金币的用户
- **发布流程**：
  1. 填写需求（标题、简介、分类、交付时间）
  2. 设置预算（金币）
  3. 冻结托管预算金币
  4. 发布到商单市场

### 8.2 接单流程
- **创作者**浏览商单列表
- 提交申请（方案说明）
- 发布者选定中标者
- 创作者交付作品（提交Work ID）
- 发布者验收并放款

### 8.3 平台抽成
- **抽成比例**：5%
- **放款规则**：
  - 创作者收入：预算 × 95%
  - 平台收入：预算 × 5%
  - 创作者收入冻结7天后可提

### 8.4 取消与退款
- **允许取消条件**：
  - 订单未选定中标者
  - 或选定中标者但未交付，且创作者同意取消
- **取消操作**：
  - 发布者发起取消申请
  - 若已选人，需创作者同意
  - 退回全额预算到发布者账户

---

## 九、视频生成系统

### 9.1 生成参数

#### 时长选项
- 10秒（Sora2基础版）：10积分
- 15秒（Sora2基础版）：15积分
- 25秒（Sora2Pro）：25积分

#### 比例选项
- 9:16 竖屏（适合手机）
- 16:9 横屏（适合电脑）
- 1:1 方形（适合社交媒体）

#### 模型选项
- Sora2基础版
- Sora2Pro高级版（支持25秒、更高画质）

### 9.2 生成流程

#### 文生视频
1. 输入提示词
2. 选择参数（时长/比例/模型）
3. 选择项目（可选）
4. 预扣积分
5. 创建任务（status=QUEUED）
6. 轮询任务进度
7. 生成成功 → 视频进入资产页
8. 生成失败 → 自动退回积分

#### 图生视频
1. 上传参考图片 → 获得asset_id
2. 输入提示词
3. 选择参数（时长/比例/模型）
4. 选择项目（可选）
5. 预扣积分
6. 创建任务（带reference_image_asset_id）
7. 后续流程同文生

### 9.3 任务状态
| 状态 | 说明 | 用户操作 |
|------|------|----------|
| NOT_START | 未开始 | 等待 |
| QUEUED | 排队中 | 等待 |
| IN_PROGRESS | 生成中 | 查看进度 |
| SUCCESS | 成功 | 播放/下载/发布 |
| FAILURE | 失败 | 查看原因/重试 |

### 9.4 失败处理
- 自动退回预扣积分
- 显示失败原因
- 提供重试按钮（重新扣费生成）

---

## 十、内容分发系统

### 10.1 首页Feed算法

#### 发现页（智能推荐）
基础权重计算：
```
score = (likes × 1.0) + (favorites × 2.0) + (tips × 5.0) + (shares × 3.0)
    × time_decay_factor
    × creator_quality_score
```

#### 热门页（24小时热榜）
按点赞数排序，仅展示24小时内发布的作品

#### 排行页
- **创作者打赏排行**：按累计收到的打赏积分排序
- **展示Top10**
- **数据维度**：
  - 排名
  - 创作者头像/昵称
  - 累计打赏积分
  - 粉丝数

### 10.2 作品详情页
- **全屏视频播放**
- **作品信息**：标题、描述、提示词（需解锁）
- **统计数据**：点赞数、打赏数、收藏数、播放数
- **互动按钮**：
  - 点赞
  - 打赏并收藏（弹出档位选择）
  - 分享
  - 解锁提示词（5积分）
  - 二次创作（2积分+生成费）
- **创作者信息**：头像、昵称、关注按钮

---

## 十一、项目分类系统

### 11.1 项目用途
- 视频资产分类管理（类似文件夹）
- 生成任务时可选择项目
- 资产页按项目筛选

### 11.2 项目操作
- 创建项目（填写名称）
- 重命名项目
- 删除项目（项目下视频不删除，变为"未分类"）
- 按项目筛选视频资产

---

## 十二、扩展工具

### 12.1 扩展分镜
- **用途**：批量创建多个视频生成任务
- **操作流程**：
  1. 添加多个生成任务（每个填写提示词/参数）
  2. 一次性提交
  3. 分别预扣积分
  4. 所有任务并行生成

### 12.2 故事版（8镜头）
- **用途**：根据主题自动生成8条镜头脚本
- **操作流程**：
  1. 输入主题提示词（topic_prompt）
  2. 可选：选择全局角色（global_role_id）
  3. 生成8条镜头：
     - 每条包含：提示词、景别、运镜、时长
     - 自动编号：1-8
  4. 编辑镜头：
     - 修改提示词
     - 调整景别（远/全/中/近/特写）
     - 调整运镜（静止/推拉/跟拍等）
     - 调整时长（10/15/25秒）
  5. 拖拽排序：改变镜头顺序
  6. 批量提交：一次性提交所有镜头生成

**故事版详细规则** ⭐：

#### 默认生成规则
- **默认镜头数**：8条（固定）
- **自动编号**：镜头1、镜头2...镜头8
- **默认时长**：每条10秒（可单独修改）
- **默认比例**：继承全局设置（9:16竖屏为主）

#### 镜头操作规则
| 操作 | 是否允许 | 说明 |
|------|---------|------|
| **删除镜头** | ✅ 允许 | 可删除任意镜头，剩余镜头重新编号 |
| **新增镜头** | ✅ 允许 | 可在任意位置插入新镜头 |
| **修改提示词** | ✅ 允许 | 可单独修改每条镜头的提示词 |
| **调整参数** | ✅ 允许 | 景别/运镜/时长/角色均可调整 |
| **拖拽排序** | ✅ 允许 | 拖拽改变顺序，自动更新storyboard.shot_order |

#### 批量提交规则 ⭐
- **提交方式**：一次性全部入队
- **扣费逻辑**：
  ```python
  # 批量预扣积分
  for shot in shots:
      cost = shot.duration_sec  # 10/15/25
      total_cost += cost
  
  # 一次性扣除
  credit_wallet.balance -= total_cost
  
  # 创建多个任务（并行）
  for shot in shots:
      Task.create(
          source_type="storyboard_shot",
          source_id=shot.shot_id,
          prompt_final=shot.prompt,
          duration_sec=shot.duration_sec,
          ...
      )
  ```

- **并行生成**：所有任务同时提交到供应商，互不阻塞
- **失败处理**：单个任务失败只退回该任务的积分，不影响其他任务

#### 数据存储
- **镜头排序**：使用`storyboard.shot_order`数组存储顺序
  ```json
  {
    "storyboard_id": 123,
    "shot_order": [101, 103, 102, 105, 104, 106, 107, 108]
  }
  ```
- **优势**：
  - 拖拽排序只需更新shot_order数组
  - 不需要order_index字段
  - 删除镜头不需要重新排序

#### 用户体验
- **实时保存**：每次编辑自动保存
- **草稿机制**：未提交的故事版保存为草稿
- **批量提交提示**：
  ```
  即将提交8个镜头生成，共消耗80积分
  当前余额：120积分
  [确认提交] [取消]
  ```

---

## 十三、数据统计

### 13.1 用户统计
- likes_received_count：获赞总数
- followers_count：粉丝数
- following_count：关注数
- works_count：发布作品数

### 13.2 作品统计
- like_count：点赞数
- favorite_count：收藏数
- tip_count：打赏次数
- share_count：分享次数
- views：播放次数

### 13.3 创作者统计
- total_tipped_credits：累计收到打赏积分（用于排行）
- total_coins_earned：累计收益金币

---

## 十四、UI/UX设计规范

### 14.1 设计风格
- **主题**：iOS风格深色主题
- **主色调**：渐变蓝紫（--color-primary到--color-secondary）
- **背景色**：深灰黑渐变
- **磨砂效果**：backdrop-blur半透明卡片

### 14.2 全局Toast通知
- **位置**：顶部居中
- **样式**：黑色半透明背景 + 磨砂效果
- **类型**：
  - Success：绿色图标
  - Error：红色图标
  - Warning：黄色图标
  - Info：蓝色图标
- **显示时长**：2秒自动消失

### 14.3 确认对话框
- **样式**：iOS风格居中对话框
- **类型**：
  - confirm：确认/取消两按钮
  - alert：单确定按钮
  - prompt：带输入框
- **图标**：warning/success/error/info

### 14.4 视频播放器
- **全屏沉浸式**
- **抖音式交互**：
  - 上下滑动切换视频
  - 点击屏幕暂停/播放
  - 双击点赞（可选）
- **右侧按钮栏**：
  - 头像（点击进主页）
  - 关注按钮
  - 点赞
  - 打赏并收藏
  - 分享
  - 更多（提示词/二创）
- **底部信息**：标题、描述、标签

---

## 十五、评论系统（预留）

### 15.1 评论功能（暂不开发）
- 预留数据结构：Comment表
- 预留接口路径（返回501或空）
- 后续可扩展：
  - 评论列表
  - 发表评论
  - 评论点赞
  - 评论回复

---

## 十六、安全与权限

### 16.1 视频下载权限
- **水印版**：所有人可免费在线播放
- **无水印版**：
  - 仅限视频所有者下载
  - 扣除6积分
  - 后端代理下载（不返回直链）

### 16.2 内容安全
- 用户上传图片审核（预留）
- 生成内容敏感词过滤（预留）
- 用户举报机制（预留）

### 16.3 财务安全
- 所有收入冻结7天后可提
- 提现人工审核（可选）
- 异常交易监控（预留）

---

## 十七、开发优先级

### Phase 0：基础设施（1-2天）
✅ 用户登录（手机验证码/微信）
✅ 双钱包系统（credits/coins）
✅ 基础流水查询

### Phase 1：核心闭环（3-7天）
✅ 视频生成（文生/图生）
✅ 任务队列与轮询
✅ 视频资产管理
✅ 无水印下载
✅ 项目分类

### Phase 2：内容增长（7-14天）
✅ 发布作品
✅ 首页Feed（发现/热门/排行）
✅ 关注系统
✅ 打赏并收藏
✅ 提示词解锁
✅ 二次创作

### Phase 3：留存与变现（14-21天）
✅ 积分充值
✅ 月卡购买
✅ 任务中心
✅ 打赏排行
✅ 金币提现

### Phase 4：商单系统（后期）
✅ 发布商单
✅ 接单流程
✅ 交付验收
✅ 托管与放款

---

## 十八、成功指标（KPI）

### 18.1 用户指标
- DAU：日活跃用户数
- 次日留存率：>30%
- 7日留存率：>15%

### 18.2 创作指标
- 日均生成视频数
- 日均发布作品数
- 创作者数量

### 18.3 收入指标
- ARPU：每用户平均收入
- 充值转化率：>10%
- 月卡复购率：>50%

### 18.4 社交指标
- 人均关注数
- 人均点赞数
- 打赏渗透率

---

**文档版本**：v1.0
**最后更新**：2025-12-25
**负责人**：SkyRiff产品团队